# Лабораторная работа 3: Потоковая обработка в Apache Flink

В данной лабораторной работе необходимо выполнить анализ данных о поездках такси в Нью-Йорке с использованием Apache Flink — фреймворка для распределённой обработки потоков данных. Основная цель — реализовать четыре упражнения из репозитория `flink-training-exercises`: `RideCleansingExercise`, `RidesAndFaresExercise`, `HourlyTipsExercise` и `ExpiringStateExercise`. Каждое упражнение решает задачу обработки потоковых данных с использованием различных возможностей Flink, таких как фильтрация, обогащение, оконная агрегация и управление состоянием с истечением срока действия.

### Цели работы
Реализовать потоковую обработку данных о поездках такси в Нью-Йорке с использованием Apache Flink. Задачи включают:
- Фильтрацию поездок, начинающихся и заканчивающихся в Нью-Йорке (`RideCleansingExercise`).
- Обогащение данных о поездках информацией о тарифах с использованием состояния (`RidesAndFaresExercise`).
- Подсчёт максимальных чаевых по часам для водителей такси (`HourlyTipsExercise`).
- Обогащение поездок с учётом истечения состояния для несопоставленных данных (`ExpiringStateExercise`).

### Используемые данные
- Использованы датасеты `nycTaxiRides.gz` (данные о поездках) и `nycTaxiFares.gz` (данные о тарифах).
- Источник данных: [репозиторий Apache Flink Training](https://github.com/apache/flink-training).

---

## Результаты выполнения задач

1. **RideCleansingExercise**:
   - Реализована фильтрация потока поездок такси.
   - Оставлены только поездки, начинающиеся и заканчивающиеся в пределах Нью-Йорка, с использованием утилиты `GeoUtils`.

![1.png](assets%2F1.png)

2. **RidesAndFaresExercise**:
   - Выполнено обогащение данных о поездках (`TaxiRide`) данными о тарифах (`TaxiFare`).
   - Использовано состояние для временного хранения несопоставленных записей с помощью `RichCoFlatMapFunction`.

   ![2.png](assets%2F2.png)

3. **HourlyTipsExercise**:
   - Подсчитана сумма чаевых для каждого водителя по часам с использованием оконной функции.
   - Найдена максимальная сумма чаевых за каждый час среди всех водителей.

   ![3.png](assets%2F3.png)

4. **ExpiringStateExercise**:
   - Реализовано обогащение поездок с учётом истечения состояния.
   - Несопоставленные поездки и тарифы отправлены в боковые выходы (`unmatchedRides` и `unmatchedFares`) по истечении времени ожидания.

   ![4.png](assets%2F4.png)
